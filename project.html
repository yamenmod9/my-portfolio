<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - MyPortfolio</title>
    <link rel="stylesheet" href="../../../static/css/style.css">
    <link rel="stylesheet" href="../../../static/css/project.css">
    <script src="../../../static/js/script.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header class="project-header" style="background: linear-gradient(90deg, {{ project.color }} 0%, #ffffff 100%);">
        <nav class="navbar">
            <div class="logo">MyPortfolio</div>
            <ul class="nav-links">
                <li><a href="../../../index.html">Home</a></li>
                <li class="active"><a href="#">Projects</a></li>
                <li><a href="../../../index.html#about">About</a></li>
                <li><a href="../../../index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main class="project-container">
        <!-- Project Banner -->
        <section class="project-banner">
            <h1>{{ project.title }}</h1>
            <div class="project-meta">
                <span class="project-category">{{ project.category }}</span>
                <span class="project-type">{{ project.type }}</span>
                
                <!-- Star Rating Display -->
                <div class="rating-display">
                    {% for i in range(5) %}
                        {% if i < avg_rating|int %}
                            <span class="star filled">★</span>
                        {% else %}
                            <span class="star">☆</span>
                        {% endif %}
                    {% endfor %}
                    <span class="rating-count">({{ project_ratings|length }} reviews)</span>
                </div>
            </div>
        </section>

        <!-- Project Details -->
        <section class="project-details">
            {% if project.screenshots and project.screenshots|length > 0 %}
            <div class="project-image carousel-wrapper">
                <div class="carousel">
                    <div class="carousel-container">
                        {% for screenshot in project.screenshots %}
                        <div class="carousel-slide">
                            <img src="../../../projects/{{ project.dirname }}/screenshots/{{ screenshot }}" alt="{{ project.title }} Screenshot">
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-button prev">&lt;</button>
                    <button class="carousel-button next">&gt;</button>
                    <div class="carousel-dots">
                        {% for screenshot in project.screenshots %}
                        <span class="dot {% if loop.index0 == 0 %}active{% endif %}" data-index="{{ loop.index0 }}"></span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="project-image">
                <img src="../../../static/images/projects/{{ project.image }}" alt="{{ project.title }}">
            </div>
            {% endif %}
            
            <div class="project-info">
                <div class="info-section">
                    <h2>Project Overview</h2>
                    <p>{{ project.description }}</p>
                </div>
                
                <div class="info-section">
                    <h2>Technologies Used</h2>
                    <ul class="tech-list">
                        {% for tech in project.technologies %}
                            <li>{{ tech }}</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="info-section">
                    <h2>Key Features</h2>
                    <ul class="feature-list">
                        {% for feature in project.features %}
                            <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </section>

        <!-- Rating Analytics Section -->
        {% if project_ratings|length > 0 %}
        <section class="rating-analytics">
            <h2>Customer Rating Analytics</h2>
            <div class="analytics-container">
                <div class="analytics-summary">
                    <div class="avg-rating">
                        <div class="avg-rating-value">{{ "%.1f"|format(avg_rating) }}</div>
                        <div class="avg-rating-stars">
                            {% for i in range(5) %}
                                {% if i < avg_rating|int %}
                                    <span class="star filled">★</span>
                                {% elif i < avg_rating|float and i >= avg_rating|int %}
                                    <span class="star half-filled">★</span>
                                {% else %}
                                    <span class="star">☆</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="total-ratings">Based on {{ project_ratings|length }} reviews</div>
                    </div>
                    <div class="rating-distribution">
                        <canvas id="ratingChart" width="300" height="200"></canvas>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Rating Section -->
        <section class="rating-section">
            <h2>Rate This Project</h2>
            
            <form action="#" method="post" class="rating-form" id="ratingForm">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone:</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                
                <div class="form-group star-rating">
                    <label>Your Rating:</label>
                    <div class="star-container" id="interactiveStars">
                        <input type="radio" name="rating" id="star5" value="5" checked>
                        <label for="star5" class="interactive-star" data-rating="5">★</label>
                        
                        <input type="radio" name="rating" id="star4" value="4">
                        <label for="star4" class="interactive-star" data-rating="4">★</label>
                        
                        <input type="radio" name="rating" id="star3" value="3">
                        <label for="star3" class="interactive-star" data-rating="3">★</label>
                        
                        <input type="radio" name="rating" id="star2" value="2">
                        <label for="star2" class="interactive-star" data-rating="2">★</label>
                        
                        <input type="radio" name="rating" id="star1" value="1">
                        <label for="star1" class="interactive-star" data-rating="1">★</label>
                    </div>
                    <div class="rating-feedback" id="ratingFeedback">Excellent!</div>
                </div>
                
                <button type="submit" class="btn btn-primary">Submit Rating</button>
            </form>
        </section>
        
        <!-- Previous Ratings Section -->
        {% if project_ratings|length > 0 %}
        <section class="previous-ratings">
            <h2>Customer Reviews</h2>
            <div class="ratings-list">
                {% for rating in project_ratings %}
                <div class="rating-item">
                    <div class="rating-header">
                        <div class="rating-user">{{ rating.name }}</div>
                        <div class="rating-date">{{ rating.date }}</div>
                    </div>
                    <div class="rating-stars">
                        {% for i in range(5) %}
                            {% if i < rating.rating %}
                                <span class="star filled">★</span>
                            {% else %}
                                <span class="star">☆</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}
        
        <div class="back-link">
            <a href="../../../index.html#projects">← Back to All Projects</a>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Yamen Hegazy — Student Developer & Web App Builder</p>
        <p>Flask • Django • HTML • CSS • Python • JavaScript</p>
        <p>
            <a href="mailto:yamen.mahmoud912@gmail.com">Contact Me</a> |
            <a href="https://github.com/yamenmod9" target="_blank" rel="noopener noreferrer">GitHub</a> |
            <a href="https://www.linkedin.com/in/yamen-mahmoud-49429829b" target="_blank" rel="noopener noreferrer">LinkedIn</a>
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Interactive star rating
            const stars = document.querySelectorAll('.interactive-star');
            const ratingFeedback = document.getElementById('ratingFeedback');
            const feedbackTexts = {
                1: 'Poor',
                2: 'Fair',
                3: 'Good',
                4: 'Very Good',
                5: 'Excellent!'
            };

            stars.forEach(star => {
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.dataset.rating);
                    updateStars(rating);
                    ratingFeedback.textContent = feedbackTexts[rating];
                });

                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    document.getElementById('star' + rating).checked = true;
                });
            });

            const starContainer = document.getElementById('interactiveStars');
            if (starContainer) {
                starContainer.addEventListener('mouseout', function() {
                    // Find which radio is checked
                    const checkedRating = document.querySelector('input[name="rating"]:checked').value;
                    updateStars(checkedRating);
                    ratingFeedback.textContent = feedbackTexts[checkedRating];
                });
            }

            function updateStars(rating) {
                stars.forEach(star => {
                    const starRating = parseInt(star.dataset.rating);
                    if (starRating <= rating) {
                        star.classList.add('hovered');
                    } else {
                        star.classList.remove('hovered');
                    }
                });
            }

            // Initialize rating chart if it exists
            const chartCanvas = document.getElementById('ratingChart');
            if (chartCanvas) {
                // Calculate ratings distribution
                const ratings = {{ project_ratings|map(attribute='rating')|list|tojson }};
                const distribution = [0, 0, 0, 0, 0]; // 1-5 stars
                
                ratings.forEach(rating => {
                    distribution[rating-1]++;
                });

                // Create chart
                const ctx = chartCanvas.getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['1★', '2★', '3★', '4★', '5★'],
                        datasets: [{
                            label: 'Number of Ratings',
                            data: distribution,
                            backgroundColor: [
                                '#FF6B6B',
                                '#FFD166',
                                '#06D6A0',
                                '#118AB2',
                                '#4158D0'
                            ],
                            borderWidth: 0,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    precision: 0
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Carousel functionality
            const carousel = document.querySelector('.carousel');
            if (carousel) {
                const container = carousel.querySelector('.carousel-container');
                const slides = carousel.querySelectorAll('.carousel-slide');
                const dots = carousel.querySelectorAll('.dot');
                const prevBtn = carousel.querySelector('.prev');
                const nextBtn = carousel.querySelector('.next');
                
                let currentIndex = 0;
                const slideWidth = 100; // percentage
                
                // Set initial position
                updateCarousel();
                
                // Event listeners
                prevBtn.addEventListener('click', () => {
                    currentIndex = (currentIndex > 0) ? currentIndex - 1 : slides.length - 1;
                    updateCarousel();
                });
                
                nextBtn.addEventListener('click', () => {
                    currentIndex = (currentIndex < slides.length - 1) ? currentIndex + 1 : 0;
                    updateCarousel();
                });
                
                dots.forEach(dot => {
                    dot.addEventListener('click', () => {
                        currentIndex = parseInt(dot.dataset.index);
                        updateCarousel();
                    });
                });
                
                function updateCarousel() {
                    // Update slides position
                    container.style.transform = `translateX(-${currentIndex * slideWidth}%)`;
                    
                    // Update dots
                    dots.forEach((dot, index) => {
                        if (index === currentIndex) {
                            dot.classList.add('active');
                        } else {
                            dot.classList.remove('active');
                        }
                    });
                }
                
                // Auto-advance carousel
                setInterval(() => {
                    currentIndex = (currentIndex < slides.length - 1) ? currentIndex + 1 : 0;
                    updateCarousel();
                }, 5000);
            }
        });
    </script>
</body>
</html>
